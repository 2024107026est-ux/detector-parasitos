
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Definitiva - Modelo Reparado</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 10px; }
        .console { background: black; color: lime; padding: 15px; height: 300px; overflow-y: auto; font-family: monospace; }
        button { background: #28a745; color: white; border: none; padding: 15px 25px; margin: 10px; border-radius: 8px; cursor: pointer; font-size: 16px; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üéØ Prueba Definitiva - Modelo Reparado</h1>
    
    <div class="test">
        <h2>1. Carga del Modelo Reparado</h2>
        <button onclick="cargarModeloReparado()">Cargar Modelo Reparado</button>
        <div id="resultadoCarga"></div>
    </div>
    
    <div class="test">
        <h2>2. Verificaci√≥n de Estructura</h2>
        <button onclick="verificarEstructura()">Verificar Estructura</button>
        <div id="resultadoEstructura"></div>
    </div>
    
    <div class="test">
        <h2>3. Prueba de Detecci√≥n</h2>
        <button onclick="probarDeteccion()">Probar Detecci√≥n</button>
        <div id="resultadoDeteccion"></div>
    </div>
    
    <div class="test">
        <h2>4. Estado Final del Sistema</h2>
        <button onclick="verificarSistemaCompleto()">Verificar Sistema Completo</button>
        <div id="resultadoFinal"></div>
    </div>
    
    <h3>Consola del Sistema:</h3>
    <div id="console" class="console"></div>

    <script>
        let modelo = null;
        const consoleEl = document.getElementById('console');
        
        function log(mensaje, tipo = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = tipo === 'error' ? 'red' : tipo === 'success' ? 'lime' : 'cyan';
            consoleEl.innerHTML += `<div style="color: ${color}">[${time}] ${mensaje}</div>`;
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function mostrarResultado(elementId, mensaje, esExitoso = true) {
            const elemento = document.getElementById(elementId);
            elemento.innerHTML = esExitoso ? 
                `<div class="success">‚úÖ ${mensaje}</div>` :
                `<div class="error">‚ùå ${mensaje}</div>`;
        }

        async function cargarModeloReparado() {
            log('üîÑ CARGANDO MODELO REPARADO...', 'info');
            try {
                if (modelo) modelo.dispose();
                
                modelo = await tf.loadLayersModel('modelo/model.json');
                mostrarResultado('resultadoCarga', 
                    `MODELO CARGADO EXITOSAMENTE<br>
                     Input: [${modelo.inputs[0].shape}]<br>
                     Output: [${modelo.outputs[0].shape}]`);
                log('‚úÖ ¬°MODELO REPARADO CARGADO CORRECTAMENTE!', 'success');
                return true;
            } catch (error) {
                mostrarResultado('resultadoCarga', `Error: ${error.message}`, false);
                log(`‚ùå Error: ${error.message}`, 'error');
                return false;
            }
        }

        async function verificarEstructura() {
            if (!modelo) {
                mostrarResultado('resultadoEstructura', 'Primero carga el modelo', false);
                return;
            }
            
            try {
                const inputShape = modelo.inputs[0].shape;
                const outputShape = modelo.outputs[0].shape;
                const numCapas = modelo.layers.length;
                const primeraCapa = modelo.layers[0].__class__.__name__;
                
                mostrarResultado('resultadoEstructura',
                    `ESTRUCTURA CORRECTA<br>
                     ‚Ä¢ Input: [${inputShape}]<br>
                     ‚Ä¢ Output: [${outputShape}]<br>
                     ‚Ä¢ Capas: ${numCapas}<br>
                     ‚Ä¢ Primera capa: ${primeraCapa}`);
                log('‚úÖ Estructura verificada correctamente', 'success');
            } catch (error) {
                mostrarResultado('resultadoEstructura', `Error: ${error.message}`, false);
            }
        }

        async function probarDeteccion() {
            if (!modelo) {
                mostrarResultado('resultadoDeteccion', 'Primero carga el modelo', false);
                return;
            }
            
            try {
                log('üß™ Realizando detecci√≥n de prueba...', 'info');
                const entrada = tf.ones([1, 224, 224, 3]);
                const salida = modelo.predict(entrada);
                const resultados = await salida.data();
                
                const suma = Array.from(resultados).reduce((a, b) => a + b, 0).toFixed(4);
                
                mostrarResultado('resultadoDeteccion',
                    `DETECCI√ìN EXITOSA<br>
                     ‚Ä¢ Shape: [${salida.shape}]<br>
                     ‚Ä¢ Suma probabilidades: ${suma}<br>
                     ‚Ä¢ Sistema operativo al 100%`);
                log('‚úÖ Detecci√≥n completada exitosamente', 'success');
                
                entrada.dispose();
                salida.dispose();
            } catch (error) {
                mostrarResultado('resultadoDeteccion', `Error: ${error.message}`, false);
            }
        }

        async function verificarSistemaCompleto() {
            log('üöÄ VERIFICACI√ìN COMPLETA DEL SISTEMA...', 'info');
            
            const cargaExitosa = await cargarModeloReparado();
            if (!cargaExitosa) {
                mostrarResultado('resultadoFinal', 
                    'SISTEMA PARCIAL: Solo modelo en memoria funciona', false);
                return;
            }
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            await verificarEstructura();
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            await probarDeteccion();
            
            mostrarResultado('resultadoFinal',
                'üéâ ¬°SISTEMA 100% OPERATIVO!<br>‚Ä¢ Modelo desde archivos: ‚úÖ FUNCIONANDO<br>‚Ä¢ Detecciones: ‚úÖ OPERATIVAS');
            log('üéØ SISTEMA COMPLETAMENTE OPERATIVO', 'success');
        }

        // Iniciar autom√°ticamente
        log('Sistema de prueba definitiva cargado', 'info');
        log('TensorFlow.js ' + tf.version.tfjs, 'info');
        log('Haz clic en "Verificar Sistema Completo"', 'info');
    </script>
</body>
</html>
